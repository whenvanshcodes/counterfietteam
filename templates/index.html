<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake Currency Detector</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- AI Insights Side Panel -->
    <div id="ai-insights-panel" class="side-panel">
        <div class="panel-header">
            <h3><i class="fas fa-brain"></i> AI Insights</h3>
            <button id="close-panel" class="close-btn">&times;</button>
        </div>
        <div class="panel-content">
            <div class="panel-section">
                <h4>Model Info</h4>
                <p><strong>Version:</strong> <span id="model-version">Loading...</span></p>
                <p><strong>Type:</strong> <span id="model-type">Loading...</span></p>
                <p><strong>Accuracy:</strong> <span id="model-accuracy">Loading...</span></p>
            </div>
            <div class="panel-section">
                <h4>Scan Difficulty</h4>
                <div class="difficulty-meter-panel">
                    <div id="panel-difficulty-bar" class="difficulty-fill" style="width: 50%;"></div>
                </div>
                <small id="panel-difficulty-text">Moderate</small>
            </div>
            <div class="panel-section">
                <h4><i class="fas fa-exclamation-triangle"></i> Known Limitations</h4>
                <ul id="model-limitations">
                    <li>Loading...</li>
                </ul>
            </div>
        </div>
    </div>
    <button id="open-insights-btn" class="floating-btn" title="AI Insights"><i class="fas fa-brain"></i></button>

    <div class="container">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-shield-alt"></i> Fake Currency Detection</h1>
                <p>Advanced AI-powered forensic analysis system</p>
            </div>
            <div class="header-actions">
                <button id="lang-toggle" class="tool-icon" title="Switch Language">EN/HI</button>
                
                <div class="dropdown" id="access-dropdown">
                    <button class="tool-icon dropdown-toggle" id="access-menu-btn" title="Accessibility Options">
                        <i class="fas fa-universal-access"></i>
                    </button>
                    <div class="dropdown-menu">
                        <div class="menu-header">Accessibility</div>
                        <div class="menu-item">
                            <span>Font Size</span>
                            <div class="font-controls-mini">
                                <button id="font-decrease"><i class="fas fa-minus"></i></button>
                                <button id="font-increase"><i class="fas fa-plus"></i></button>
                            </div>
                        </div>
                        <div class="menu-item">
                            <button id="access-mode" class="full-width-btn">
                                <i class="fas fa-eye"></i> High Contrast
                            </button>
                        </div>
                    </div>
                </div>

                <a href="/admin/login" class="admin-link" title="Admin Login">
                    <i class="fas fa-user-shield"></i>
                </a>
                <button id="theme-toggle" class="theme-btn" title="Toggle Theme"><i class="fas fa-moon"></i></button>
            </div>
        </header>

        <div class="upload-section">
            <!-- Upload Tips Toggle -->
            <div class="tips-toggle" onclick="toggleTips()">
                <i class="fas fa-lightbulb"></i> Upload Tips for Best Results
            </div>
            <div id="upload-tips" class="upload-tips hidden">
                <div class="tip-grid">
                    <div class="tip-item"><i class="fas fa-expand"></i> Use flat surface</div>
                    <div class="tip-item"><i class="fas fa-sun"></i> Avoid shadows</div>
                    <div class="tip-item"><i class="fas fa-camera"></i> High resolution</div>
                    <div class="tip-item"><i class="fas fa-crop"></i> Fill the frame</div>
                </div>
            </div>

            <!-- Image Quality Advisory -->
            <div id="quality-advisory" class="quality-advisory hidden">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="advisory-text">Image quality is low. Results may be inaccurate.</span>
            </div>

            <!-- Scan Context Selector -->
            <div class="context-selector">
                <label for="scan-context"><i class="fas fa-tag"></i> Scan Context:</label>
                <select id="scan-context">
                    <option value="personal">Personal Use</option>
                    <option value="shop">Shop Received</option>
                    <option value="bank">Bank Exchange</option>
                    <option value="learning">Learning / Demo</option>
                </select>
            </div>

            <div class="drop-zone" id="drop-zone">
                <div class="scan-overlay" id="scan-overlay"></div>
                <div class="upload-content">
                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                    <p>Drag & Drop currency image here</p>
                    <p class="sub-text">or click to browse</p>
                    <div class="divider"><span>OR</span></div>
                    <div class="upload-actions">
                        <button id="camera-btn" class="camera-btn"><i class="fas fa-camera"></i> Use Camera</button>
                        <button id="demo-btn" class="demo-btn"><i class="fas fa-flask"></i> Demo Mode</button>
                    </div>
                </div>
                <input type="file" id="file-input" accept="image/*" hidden>
            </div>
            
            <!-- Camera Interface -->
            <div id="camera-interface" class="hidden">
                <video id="camera-stream" autoplay playsinline></video>
                <div class="camera-controls">
                    <button id="capture-btn" class="capture-btn"><i class="fas fa-circle"></i></button>
                    <button id="close-camera" class="close-camera"><i class="fas fa-times"></i></button>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="timeline-container">
                <div class="timeline-step" id="step-1">
                    <div class="step-icon"><i class="fas fa-upload"></i></div>
                    <div class="step-label">Uploading</div>
                </div>
                <div class="timeline-line"></div>
                <div class="timeline-step" id="step-2">
                    <div class="step-icon"><i class="fas fa-microchip"></i></div>
                    <div class="step-label">Analyzing</div>
                </div>
                <div class="timeline-line"></div>
                <div class="timeline-step" id="step-3">
                    <div class="step-icon"><i class="fas fa-shield-alt"></i></div>
                    <div class="step-label">Verifying</div>
                </div>
            </div>
            <p id="loading-text">Processing image...</p>
        </div>

        <!-- Stats Dashboard -->
        <div class="stats-container">
            <div class="stat-card">
                <h3><i class="fas fa-check-circle" style="color: var(--success-color)"></i> Real</h3>
                <span id="stat-real">0</span>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-exclamation-triangle" style="color: var(--danger-color)"></i> Fake</h3>
                <span id="stat-fake">0</span>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-chart-pie"></i> Total</h3>
                <span id="stat-total">0</span>
            </div>
        </div>

        <!-- Session Panel -->
        <div class="session-panel">
            <div class="session-header">
                <h3><i class="fas fa-calculator"></i> Session Calculator</h3>
                <span id="session-total">â‚¹0</span>
            </div>
            <div class="session-stats">
                <small>Session Scans: <span id="session-count">0</span></small>
                <small>Verified: <span id="session-verified">0%</span></small>
            </div>
        </div>

        <div id="result" class="result-container hidden">
            <!-- Results will be injected here -->
    </div>
    
    <!-- 4. Authenticity Certificate UI (Hidden by default, shown for REAL) -->
    <div id="certificate-container" class="certificate-container hidden">
        <div class="certificate-card">
            <div class="cert-header">
                <i class="fas fa-certificate"></i>
                <h2>Certificate of Authenticity</h2>
            </div>
            <div class="cert-body">
                <div class="cert-row">
                    <span>Scan ID:</span>
                    <strong id="cert-id">Loading...</strong>
                </div>
                <div class="cert-row">
                    <span>Timestamp:</span>
                    <strong id="cert-date">Loading...</strong>
                </div>
                <div class="cert-row">
                    <span>Confidence:</span>
                    <strong id="cert-confidence">Loading...</strong>
                </div>
                <div class="cert-seal">
                    <i class="fas fa-check-double"></i>
                    <span>Verified by AI System</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. Confidence Drift & 6. Risk Level -->
    <div id="analysis-insights" class="insights-container hidden">
        <div class="insight-grid">
            <div class="insight-card">
                <h4><i class="fas fa-chart-line"></i> Confidence Drift</h4>
                <p id="drift-text">Compared to last 10 scans: <span class="trend-up">â†‘ +1.2%</span></p>
            </div>
            <div class="insight-card">
                <h4><i class="fas fa-shield-alt"></i> Risk Level</h4>
                <div id="risk-badge" class="risk-badge low">ðŸŸ¢ Low Risk</div>
            </div>
        </div>
    </div>

    <!-- 7. Scan Difficulty & 9. Condition Assessment -->
    <div id="scan-meta" class="scan-meta-container hidden">
        <div class="meta-row">
            <div class="meta-item">
                <span class="meta-label">Scan Difficulty</span>
                <div class="difficulty-meter">
                    <div id="difficulty-bar" class="difficulty-fill" style="width: 30%;"></div>
                </div>
                <small id="difficulty-text">Easy to analyze</small>
            </div>
            <div class="meta-item">
                <span class="meta-label">Note Condition</span>
                <div id="condition-tags" class="condition-tags">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- 8. Smart Suggestions -->
    <div id="smart-suggestions" class="suggestions-panel hidden">
        <h4><i class="fas fa-robot"></i> Smart Suggestions</h4>
        <ul id="suggestion-list">
            <!-- Dynamic suggestions -->
        </ul>
    </div>
    
    <!-- 10. Model Confidence Disclaimer -->
    <div class="disclaimer-panel">
        <details>
            <summary><i class="fas fa-info-circle"></i> AI Model Disclaimer</summary>
            <p>AI predictions are probabilistic (Model: MobileNetV2, Accuracy: ~98%) and should be verified manually. This tool is for preliminary screening only.</p>
        </details>
    </div>

    <div class="history-section">
            <div class="history-header">
                <h3><i class="fas fa-history"></i> Analysis History</h3>
                <button id="clear-history" class="btn-text text-danger">Clear History</button>
            </div>
            <div id="history-list" class="history-list"></div>
        </div>

        <!-- Education Section -->
        <div class="education-section">
            <h3><i class="fas fa-graduation-cap"></i> Currency Education</h3>
            <div class="edu-grid">
                <div class="edu-card">
                    <h4><i class="fas fa-water"></i> Watermark</h4>
                    <p>Hold the note against light to see the Gandhi portrait and denomination. This is a primary security feature.</p>
                </div>
                <div class="edu-card">
                    <h4><i class="fas fa-grip-lines"></i> Security Thread</h4>
                    <p>The thread changes color from green to blue when tilted. It is woven into the currency paper.</p>
                </div>
                <div class="edu-card">
                    <h4><i class="fas fa-braille"></i> Bleed Lines</h4>
                    <p>Raised lines on the edges help visually impaired people identify the denomination.</p>
                </div>
                <div class="edu-card">
                    <h4><i class="fas fa-history"></i> History</h4>
                    <p>Indian currency has evolved with new series (Mahatma Gandhi New Series) introducing enhanced security features to combat counterfeiting.</p>
                </div>
            </div>
            <div class="faq-section">
                <h3><i class="fas fa-question-circle"></i> Frequently Asked Questions</h3>
                <details>
                    <summary>What does this app do?</summary>
                    <p>This app uses Artificial Intelligence (MobileNetV2) to analyze visual patterns, textures, and security features in currency images to estimate authenticity.</p>
                </details>
                <details>
                    <summary>What does it NOT do?</summary>
                    <p>It cannot verify physical properties like paper quality, magnetic ink, or UV fluorescence. It relies solely on visual data from the image.</p>
                </details>
                <details>
                    <summary>When to trust the results?</summary>
                    <p>Results are most reliable with high-resolution, well-lit images. If the "Confidence" is low or the app shows "Uncertain", please verify manually at a bank.</p>
                </details>
                <details>
                    <summary>How accurate is this app?</summary>
                    <p>The app uses a MobileNetV2 model with ~98% accuracy on the test dataset, but real-world performance depends heavily on image quality.</p>
                </details>
                <details>
                    <summary>What should I do with a fake note?</summary>
                    <p>Do not recirculate it, as that is a punishable offense. Hand it over to a bank branch or police station.</p>
                </details>
            </div>
        </div>
    </div>

    <!-- Image Lightbox -->
    <div id="lightbox" class="lightbox hidden">
        <span class="lightbox-close">&times;</span>
        <div class="lightbox-container">
            <div class="lightbox-toolbar">
                <button class="tool-btn active" onclick="switchView('original')"><i class="fas fa-image"></i> Original</button>
                <button class="tool-btn" onclick="switchView('edges')"><i class="fas fa-water"></i> Edge Map</button>
                <button class="tool-btn" onclick="switchView('noise')"><i class="fas fa-braille"></i> Texture</button>
                <button class="tool-btn" onclick="switchView('contrast')"><i class="fas fa-adjust"></i> Contrast</button>
                <button class="tool-btn" onclick="switchView('heatmap')"><i class="fas fa-fire"></i> Heatmap</button>
            </div>
            <div class="lightbox-view-area">
                <img class="lightbox-content" id="lightbox-img">
                <div id="lightbox-loader" class="loader-spinner hidden"></div>
            </div>
            <div id="lightbox-caption"></div>
        </div>
    </div>

    <!-- Compare Mode Modal with Slider -->
    <div id="compare-modal" class="lightbox hidden">
        <span class="lightbox-close" onclick="closeCompare()">&times;</span>
        <div class="compare-container">
            <h2><i class="fas fa-columns"></i> Forensic Comparison</h2>
            <p class="compare-instruction">Drag the slider to compare with a reference authentic note.</p>
            
            <div class="img-comp-container">
                <div class="img-comp-img">
                    <img id="compare-img-real" src="{{ url_for('static', filename='reference.jpg') }}" alt="Reference Real Note">
                </div>
                <div class="img-comp-img img-comp-overlay">
                    <img id="compare-img-suspect" alt="Suspect Note">
                </div>
            </div>
            
            <div class="compare-legend">
                <span><i class="fas fa-arrow-left"></i> Suspect Note</span>
                <span>Reference Note <i class="fas fa-arrow-right"></i></span>
            </div>
        </div>
    </div>

    <!-- Printable Report Template -->
    <div id="print-report" class="print-only">
        <div class="report-header">
            <h1>Forensic Analysis Report</h1>
            <p class="report-meta">Generated by Fake Currency Detection System</p>
            <div class="report-info">
                <div><strong>File:</strong> <span id="report-filename">-</span></div>
                <div><strong>Date:</strong> <span id="report-date">-</span></div>
                <div><strong>ID:</strong> <span id="report-id">-</span></div>
            </div>
        </div>

        <div class="report-summary">
            <h2>Analysis Summary</h2>
            <div class="report-badges">
                <div id="report-badge" class="badge"></div>
                <div class="confidence-box">
                    <span>Confidence Score</span>
                    <strong id="report-confidence">-</strong>
                </div>
            </div>
            <div id="report-reasons" class="report-reasons hidden">
                <h3>Detected Anomalies</h3>
                <ul id="report-reasons-list"></ul>
            </div>
        </div>

        <div class="report-visuals">
            <h2>Visual Forensic Layers</h2>
            <div class="visual-grid">
                <div class="visual-item">
                    <img id="report-img-original" alt="Original">
                    <span>Original Image</span>
                </div>
                <div class="visual-item">
                    <img id="report-img-edges" alt="Edge Detection">
                    <span>Edge Map (Structure)</span>
                </div>
                <div class="visual-item">
                    <img id="report-img-heatmap" alt="Heatmap">
                    <span>Spectral Heatmap (Ink Density)</span>
                </div>
                <div class="visual-item">
                    <img id="report-img-noise" alt="Noise Analysis">
                    <span>Texture/Noise Analysis</span>
                </div>
            </div>
        </div>

        <div class="report-footer">
            <p>This report is computer-generated and is intended for preliminary forensic screening.</p>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
